<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&#x1f4cb; Zusammenfassung&colon; Story 5&period;1&comma; Struktur-Entscheidungen &amp; Styleguide-Vorlage</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h2 id="-zusammenfassung-story-51-struktur-entscheidungen--styleguide-vorlage">üìã Zusammenfassung: Story 5.1, Struktur-Entscheidungen &amp; Styleguide-Vorlage</h2>
<h3 id="-status-quo-aktuelle-aufgabenstellung-stand-23052025">üß© Status Quo: Aktuelle Aufgabenstellung (Stand 23.05.2025)</h3>
<ul>
<li>Ziel: Story 5.1 ‚ÄûBenutzerdaten bearbeiten&quot; voll funktionsf√§hig und sauber umgesetzt als <strong>Vorlage f√ºr alle weiteren Stories</strong>.</li>
<li>Fokus liegt aktuell auf: <strong>Funktionalit√§t</strong> bis zur Endabnahme (in 4 Tagen).</li>
<li>Refactoring und Style-Anpassung folgen danach (4 Wochen Pufferzeit).</li>
</ul>
<hr>
<h2 id="-umsetzung-story-51-benutzerdaten-bearbeiten">‚úÖ Umsetzung Story 5.1 (Benutzerdaten bearbeiten)</h2>
<h3 id="-beteiligte-komponenten-frontend-bis-backend">üîÑ Beteiligte Komponenten (Frontend bis Backend):</h3>
<ul>
<li><strong>View:</strong> <code>UserEdit.razor</code></li>
<li><strong>ViewModel:</strong> <code>UserEditViewModel.cs</code> (ausgelagert)</li>
<li><strong>ApiClient:</strong> <code>UserApi.cs</code> + <code>IUserApi.cs</code></li>
<li><strong>DTO:</strong> <code>UserDto.cs</code></li>
<li><strong>Model:</strong> <code>User.cs</code></li>
<li><strong>Mapper:</strong> <code>UserMapper.cs</code> in <code>Services/Mapping</code></li>
<li><strong>Service:</strong> <code>UserService.cs</code> + <code>IUserService.cs</code></li>
<li><strong>Repository:</strong> <code>UserRepository.cs</code> + <code>IUserRepository.cs</code></li>
<li><strong>Auth:</strong> <code>JwtClaimHelper.cs</code> + <code>JwtAuthenticationStateProvider.cs</code></li>
</ul>
<h3 id="-besondere-logik">üîß Besondere Logik:</h3>
<ul>
<li>Passwort wird nur gespeichert, wenn ein neues √ºbermittelt wird.</li>
<li>Benutzer-ID wird √ºber JWT <code>sub</code>-Claim ermittelt.</li>
<li>Authentifizierungsstatus wird per <code>AuthenticationStateProvider</code> gepr√ºft.</li>
</ul>
<hr>
<h2 id="-architekturempfehlungen-als-styleguide-grundlage">üß± Architekturempfehlungen (als Styleguide-Grundlage)</h2>
<h3 id="-1-trennung-von-zust√§ndigkeiten-single-responsibility-principle">üîó 1. <strong>Trennung von Zust√§ndigkeiten (Single Responsibility Principle)</strong></h3>
<table>
<thead>
<tr>
<th>Schicht</th>
<th>Aufgabe</th>
</tr>
</thead>
<tbody>
<tr>
<td>Razor-Komponente</td>
<td>UI, Interaktionen, Anzeige</td>
</tr>
<tr>
<td>ViewModel</td>
<td>Validierung &amp; Datenbindung</td>
</tr>
<tr>
<td>ApiClient</td>
<td>HTTP-Kommunikation (kein <code>HttpClient</code> direkt in UI)</td>
</tr>
<tr>
<td>Service</td>
<td>Gesch√§ftslogik</td>
</tr>
<tr>
<td>Repository</td>
<td>DB-Zugriffe via Dapper</td>
</tr>
<tr>
<td>Mapper</td>
<td>Konvertierung DTO &lt;-&gt; Model</td>
</tr>
</tbody>
</table>
<h3 id="-2-jwt--authentifizierung-frontend">üîê 2. <strong>JWT &amp; Authentifizierung (Frontend)</strong></h3>
<ul>
<li><code>JwtClaimHelper</code> zentralisiert Claim-Zugriffe ‚Üí bevorzugt <code>GetUserIdAsync(...)</code></li>
<li>Claims werden √ºber <code>AuthenticationStateProvider</code> abgerufen</li>
<li>AuthHeaderHandler h√§ngt automatisch <code>Bearer</code>-Token an <code>HttpClient</code></li>
</ul>
<h3 id="-3-httpclient--factory--named-clients">üåê 3. <strong>HttpClient + Factory + Named Clients</strong></h3>
<ul>
<li><code>HttpClientFactory</code> wird genutzt f√ºr <strong>named client</strong> <code>&quot;ApiClient&quot;</code></li>
<li><code>Program.cs</code> registriert **default **``, damit <code>@inject HttpClient</code> funktioniert</li>
<li>API-Klassen (z.‚ÄØB. <code>UserApi</code>) nutzen DI, um AuthProvider &amp; Client zu kombinieren</li>
</ul>
<pre><code class="language-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserApi</span>(<span class="hljs-params">HttpClient client, AuthenticationStateProvider auth</span>)
</span></code></pre>
<h3 id="-4-warum--beibehalten">‚úÖ 4. <strong>Warum <strong>``</strong> beibehalten?</strong></h3>
<ul>
<li>Trennung UI ‚Üî API-Logik</li>
<li>testbar durch Interface</li>
<li>√ºbersichtlicher Code</li>
<li>Wiederverwendbarkeit</li>
</ul>
<hr>
<h2 id="-ausblick-refactoring-nach-endabnahme">üîÆ Ausblick Refactoring (nach Endabnahme)</h2>
<ul>
<li><strong>Mapping zentralisieren:</strong> AutoMapper oder eigene <code>MapperRegistry</code></li>
<li><strong>API-Clients vereinheitlichen:</strong> <code>BaseApi&lt;T&gt;</code> m√∂glich</li>
<li><strong>DTO ‚Üî Model konsequent trennen:</strong> keine Verwendung von DTOs im Backend</li>
<li><strong>Claims, Tokens, AuthHeader in eigene Helper-Bibliothek auslagern</strong></li>
<li><strong>Coding-Styleguide f√ºrs Team ableiten (Namenskonventionen, Struktur, DI-Strategien)</strong></li>
</ul>
<hr>
<h2 id="-hinweise-zum-weiterarbeiten">üìé Hinweise zum Weiterarbeiten</h2>
<ul>
<li>Die Codebasis ist modular und kann unabh√§ngig geladen werden</li>
<li>Bei Bedarf: alle API-Clients und Services analog zu Story 5.1 aufbauen</li>
<li>Bei Bugs: Netzwerkanalyse/Fehlermeldung ansehen ‚Üí vermutlich Auth- oder Routingproblem</li>
<li>Alle bisherigen Entscheidungen sind dokumentiert und f√ºr Wiederverwendung geeignet ‚úÖ</li>
</ul>
<hr>
<blockquote>
<p><strong>Erstellt am 23.05.2025 ‚Äì als Basis f√ºr Endabnahme und Refactoringphase</strong></p>
</blockquote>

            
            
        </body>
        </html>