@page "/User"
@inject NavigationManager Navigation

<PageTitle>Home</PageTitle>

<!-- Seitenlayout -->
<div class="flex-md-column align-content-between justify-content-center w-100 h-100">

    <!-- Kopfzeile -->
    <div class="d-flex align-items-center justify-content-between p-4 bg-light">
        <MudLink Href="/"
                 Class="d-flex align-items-center text-decoration-none"
                 Color="Color.Inherit">
            <MudPaper Class="d-flex align-items-center mr-3" Elevation="0">
                <img src="images/BitWorksSimpel-Gro.png"
                     alt="BitWorks Logo"
                     width="55" height="55" />
            </MudPaper>
            <div class="d-flex display-6 align-items-center">
                <p class="m-0">@organisationName</p>
            </div>
        </MudLink>
        <div class="d-flex align-content-center justify-content-end w-25">
            <NavLink href="/User">
                <MudAvatar Color="Color.Primary" Size="Size.Medium">U</MudAvatar>
            </NavLink>
        </div>
    </div>

    <!-- Inhalt -->
    <div class="flex-md-column w-100 h-100 p-4">

        <!-- Button über dem Grid -->
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   Class="mb-4"
                   OnClick="changeUserInfo">
            Nutzerdaten bearbeiten
        </MudButton>

        <!-- Grid -->
        <MudDataGrid T="Mitgliedschaft" Items="@Mitgliedschaften" Dense="true">
            <Columns>

                <!-- Organisation Name -->
                <PropertyColumn Property="x => x.OrganisationName" Title="Organisation" />

                <!-- E-Mail + Speichern (links) -->
                <TemplateColumn Title="E-Mail bearbeiten" CellClass="text-start">
                    <CellTemplate Context="ctx">
                        <div style="display: inline-flex; align-items: center; gap: 6px;">
                            <MudTextField @bind-Value="ctx.Item.Email"
                                          Dense="true"
                                          Style="width: 200px;" />
                            <MudButton Size="Size.Small"
                                       Color="Color.Primary"
                                       Variant="Variant.Outlined"
                                       OnClick="@(() => SpeichereEmail(ctx.Item))">
                                Speichern
                            </MudButton>
                        </div>
                    </CellTemplate>
                </TemplateColumn>

                <!-- Aktionsspalte (rechte Seite) -->
                <TemplateColumn Title="" CellClass="text-end">
                    <CellTemplate Context="ctx">
                        <div class="d-inline-flex align-items-center" style="gap: 8px;">
                            <MudButton Color="Color.Error"
                                       Variant="Variant.Filled"
                                       Size="Size.Small"
                                       OnClick="@(() => EntferneMitgliedschaft(ctx.Item))">
                                Entfernen
                            </MudButton>

                            <MudButton Color="Color.Success"
                                       Variant="Variant.Filled"
                                       Size="Size.Small"
                                       OnClick="@(() => WechselnZuOrganisation(ctx.Item))">
                                Öffnen
                            </MudButton>
                        </div>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>

    </div>
</div>

@code {
    public string organisationName = "test Orga";

    private List<Mitgliedschaft> Mitgliedschaften = new()
    {
        new Mitgliedschaft { OrganisationName = "BitWorks", Email = "du@bitworks.de", OrganisationId = "bitworks" },
        new Mitgliedschaft { OrganisationName = "CodeLab", Email = "du@codelab.org", OrganisationId = "codelab" }
    };

    public class Mitgliedschaft
    {
        public string OrganisationName { get; set; }
        public string Email { get; set; }
        public string OrganisationId { get; set; }
    }

    private void SpeichereEmail(Mitgliedschaft eintrag)
    {
        Console.WriteLine($"Email gespeichert: {eintrag.Email} für {eintrag.OrganisationName}");
    }

    private void EntferneMitgliedschaft(Mitgliedschaft eintrag)
    {
        Mitgliedschaften.Remove(eintrag);
    }

    private void WechselnZuOrganisation(Mitgliedschaft eintrag)
    {
        Navigation.NavigateTo($"/?org={eintrag.OrganisationId}");
    }

    private void changeUserInfo()
    {
        Navigation.NavigateTo("/User/Edit");
    }
}
