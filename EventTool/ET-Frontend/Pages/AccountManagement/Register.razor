@page "/register"
@inject NavigationManager Navigation
@inject ServiceClient _ServiceClient
@using System.ComponentModel.DataAnnotations
@using MudBlazor
<!--@using ET.Shared.DTOs;-->

<MudContainer MaxWidth="MaxWidth.Small" Class="d-flex align-center justify-center" Style="height: 100vh;">
    <MudCard Class="pa-6" Elevation="4">
        <MudCardContent>

            <div class="text-center mb-4">
                <MudPaper Class="d-flex justify-center mb-3" Elevation="0">
                    <img src="images/BitWorksSimpel-Gro.png" alt="BitWorks Logo" width="120" height="120" />
                </MudPaper>
            </div>

            <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-4">Registrieren Sie sich</MudText>

            <MudForm Model="@registerModel" @ref="_form" OnValidSubmit="toRegister">

                <MudTextField @bind-Value="registerModel.FirstName"
                Label="Vorname"
                For="@(() => registerModel.FirstName)"
                Required="true"
                RequiredError="Vorname ist erforderlich."
                Variant="Variant.Filled"
                Margin="Margin.Dense"
                Class="mb-3" />

                <MudTextField @bind-Value="registerModel.LastName"
                Label="Nachname"
                For="@(() => registerModel.LastName)"
                Required="true"
                RequiredError="Nachname ist erforderlich."
                Variant="Variant.Filled"
                Margin="Margin.Dense"
                Class="mb-3" />

                <MudTextField @bind-Value="registerModel.Email"
                Label="E-Mail"
                For="@(() => registerModel.Email)"
                Required="true"
                RequiredError="E-Mail ist erforderlich."
                Variant="Variant.Filled"
                Margin="Margin.Dense"
                Class="mb-3" />

                <MudTextField @bind-Value="registerModel.Password"
                Label="Passwort"
                InputType="InputType.Password"
                For="@(() => registerModel.Password)"
                Required="true"
                RequiredError="Passwort ist erforderlich."
                Variant="Variant.Filled"
                Margin="Margin.Dense"
                Class="mb-3" />

                <MudTextField @bind-Value="registerModel.RepPassword"
                Label="Passwort wiederholen"
                InputType="InputType.Password"
                For="@(() => registerModel.RepPassword)"
                Required="true"
                RequiredError="Wiederholtes Passwort ist erforderlich."
                Variant="Variant.Filled"
                Margin="Margin.Dense"
                Class="mb-3" />

                <MudButton Type="ButtonType.Submit"
                Variant="Variant.Filled"
                OnClick="toRegister"
                Color="Color.Primary"
                Class="mt-2"
                FullWidth>
                    Registrieren
                </MudButton>

            </MudForm>

            <MudText Typo="Typo.body2" Align="Align.Center" Class="mt-4">
                Haben Sie bereits ein Konto?
                <MudLink OnClick="toLogin" Class="ms-1">Anmelden</MudLink>
            </MudText>

        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private MudForm _form;
    private RegisterModel registerModel = new();


    private void toLogin()
    {
        Navigation.NavigateTo("/login");
    }

    private void toRegister()
    {
        RegisterDto userRegDTO = new RegisterDto();
        userRegDTO.Firstname = registerModel.FirstName;
        userRegDTO.Lastname = registerModel.LastName;
        userRegDTO.EMail = registerModel.Email;
        userRegDTO.Password = registerModel.Password;

        _ServiceClient.RegisterAsync(userRegDTO);
        // Console.WriteLine($"Registrierung mit DTO: {userRegDTO}");
        // z. B. Navigation.NavigateTo("/dashboard");
    }

    public class RegisterModel
    {
        [Required(ErrorMessage = "Vorname ist erforderlich.")]
        public string FirstName { get; set; }

        [Required(ErrorMessage = "Nachname ist erforderlich.")]
        public string LastName { get; set; }

        [Required(ErrorMessage = "E-Mail ist erforderlich.")]
        [EmailAddress(ErrorMessage = "Ungültige E-Mail-Adresse.")]
        public string Email { get; set; }

        [Required(ErrorMessage = "Passwort ist erforderlich.")]
        [MinLength(6, ErrorMessage = "Passwort muss mindestens 6 Zeichen lang sein.")]
        public string Password { get; set; }

        [Required(ErrorMessage = "Wiederholtes Passwort ist erforderlich.")]
        [Compare(nameof(Password), ErrorMessage = "Passwörter stimmen nicht überein.")]
        public string RepPassword { get; set; }
    }
}
