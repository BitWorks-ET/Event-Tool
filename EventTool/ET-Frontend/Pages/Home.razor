@page "/"

@inject NavigationManager Navigation

<!-- Seitentitel -->
<PageTitle>Home</PageTitle>

<!-- Hauptcontainer mit Logo, Organisationsname und Avatar -->
<div class="flex-md-column align-content-between justify-content-center w-100 h-100">
    <div class="d-flex align-items-center justify-content-between p-4 bg-light">
        <!-- Logo und Organisationsname -->
        <div class="d-flex align-content-center">
            <NavLink href="/" class="text-decoration-none">
                <MudPaper Class="d-flex align-items-center mr-3" Elevation="0" Style="cursor: pointer;">
                    <img src="images/BitWorksSimpel-Gro.png" alt="BitWorks Logo" width="55" height="55" />
                </MudPaper>
            </NavLink>
            <div class="d-flex display-6 align-items-center">
                <p class="m-0">@organisationName</p>
            </div>
        </div>

        <!-- Benutzeravatar (Platzhalter mit Buchstaben U) -->
        <div class="d-flex align-content-center justify-content-end w-25">
            <NavLink href="/User">
                <MudAvatar Color="Color.Primary" Size="Size.Medium">U</MudAvatar>
            </NavLink>
        </div>
    </div>

    <!-- Inhaltstabs -->
    <div class="flex-md-column align-content-between justify-content-center w-100 h-100">
        <MudPaper Width="100%" Height="100%">
            <MudTabs class="h-100" Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6 h-100">

                <!-- Navigation zum Login -->
                <NavLink href="/Login" class="btn-primary">
                    Login
                </NavLink>

                <!-- Tab für Events -->
                <MudTabPanel Text="Organisation">
                    <MudDataGrid T="MyEvent" Items="@Elements.Take(4)">
                        <Columns>
                            <PropertyColumn Property="x => x.Name" Title="Name" />
                            <PropertyColumn Property="x => x.Description" Title="Beschreibung" />
                            <PropertyColumn Property="x => x.RegisteredUsers" Title="Teilnehmer" />
                            <PropertyColumn Property="x => x.MaxUsers" Title="Maximale Teilnehmer" />

                            <TemplateColumn CellClass="d-flex justify-end">
                                <CellTemplate Context="eventItem">
                                    <MudStack Row Spacing="1">
                                        @if (eventItem.Item.CanBeEdited)
                                        {
                                            <MudButton Size="Size.Small"
                                                       Variant="Variant.Outlined"
                                                       Color="Color.Secondary"
                                                       OnClick="@(() => Navigation.NavigateTo($"/EventBearbeiten/{eventItem.Item.ID}"))">
                                                Bearbeiten
                                            </MudButton>
                                        }

                                        <MudButton Size="Size.Small" Variant="Variant.Filled" Color="Color.Primary">
                                            Anmelden
                                        </MudButton>
                                    </MudStack>
                                </CellTemplate>
                            </TemplateColumn>
                        </Columns>
                    </MudDataGrid>
                </MudTabPanel>

                <!-- Tab für Organisation -->
                <MudTabPanel Text="Organisation">
                    <MudText Typo="Typo.h4" Class="mb-3">Mitglieder</MudText>



                    <MudDataGrid T="Mitglied" Items="@Mitglieder" Dense="true">
                        <Columns>
                            <PropertyColumn Property="x => x.LastName" Title="Nachname" />
                            <PropertyColumn Property="x => x.Email" Title="E-Mail" />



                            <TemplateColumn Title="Rolle">
                                <CellTemplate Context="ctx">
                                    <MudSelect T="Role"
                                               Dense="true"
                                               @bind-Value="ctx.Item.Role">
                                        <MudSelectItem Value="Role.Owner">Owner</MudSelectItem>
                                        <MudSelectItem Value="Role.Mitglied">Mitglied</MudSelectItem>
                                        <MudSelectItem Value="Role.Organisator">Organisator</MudSelectItem>
                                    </MudSelect>

                                </CellTemplate>
                            </TemplateColumn>


                            <TemplateColumn Title="">
                                <CellTemplate Context="ctx">
                                    <MudButton Variant="Variant.Filled"
                                               Color="Color.Error"
                                               Size="Size.Small"
                                               OnClick="@(() => EntferneMitglied(ctx.Item))">
                                        Entfernen
                                    </MudButton>
                                </CellTemplate>
                            </TemplateColumn>
                        </Columns>
                    </MudDataGrid>

                </MudTabPanel>

                <!-- Tab für Vorlagen -->
                <MudTabPanel Text="Vorlagen">
                    <MudText>Events</MudText>
                    <MudText>Prozesse</MudText>
                    <MudText>Prozessschritte</MudText>
                </MudTabPanel>
            </MudTabs>
        </MudPaper>
    </div>
</div>

@code {
    /// <summary>
    /// Platzhaltername für die Organisation beim ersten Laden.
    /// </summary>
    public string organisationName = "test Orga";

    /// <summary>
    /// Repräsentiert ein Event mit Namen, Beschreibung und Teilnehmerzahlen.
    /// </summary>
    public class MyEvent
    {
        public int ID { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public int RegisteredUsers { get; set; }
        public int MaxUsers { get; set; }
        public bool CanBeEdited { get; set; }

        public MyEvent(int id, string name, string description, int registeredUsers, int maxUsers, bool canBeEdited)
        {
            ID = id;
            Name = name;
            Description = description;
            RegisteredUsers = registeredUsers;
            MaxUsers = maxUsers;
            CanBeEdited = canBeEdited;
        }
    }

    public enum Role { Owner, Mitglied, Organisator }

    
    public class Mitglied
    {
        public Role Role { get; set; }
        public string LastName { get; set; }
        public string Email { get; set; }

        public Mitglied() { }

        public Mitglied(string lastName, string email, Role role)
        {
            LastName = lastName;
            Email = email;
            Role = role;
        }
    }


    private IEnumerable<MyEvent> Elements;
    private List<Mitglied> Mitglieder;


    /// <summary>
    /// Wird beim Initialisieren der Komponente aufgerufen. Lädt Beispiel-Events.
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        Elements = new List<MyEvent>
        {
            new MyEvent(1, "Grillfest", "lecker!", 5, 10, false),
            new MyEvent(2, "Sommerfest", "heiß!", 40, 150, true)
        };

        Mitglieder = new List<Mitglied>
        {
        new Mitglied("Reich", "Reich@example.com", Role.Owner),
        new Mitglied("Jonas", "Jonas@example.com", Role.Organisator),
        new Mitglied("Müller", "mueller@example.com", Role.Mitglied)
        };
    
    }

    private Task UpdateRolle(Mitglied mitglied, Role neueRolle)
    {
        mitglied.Role = neueRolle;
        StateHasChanged();
        return Task.CompletedTask;
    }

    


    private void EntferneMitglied(Mitglied mitglied)
    {
        Mitglieder.Remove(mitglied);
    }
}
